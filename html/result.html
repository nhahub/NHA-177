<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results - AI Fitness Trainer</title>
    <link rel="stylesheet" href="../css/result.css">
</head>
<body>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="logo-container">
            <img src="../images/logo.png" alt="Neuro Fit AI Trainer Logo" class="logo-img">
            <div class="logo-text">NEURO FIT AI TRAINER</div>
        </div>
        <ul class="nav-links">
            <li><a href="homePage.html">Home</a></li>
            <li><a href="inputs.html">Start</a></li>
            <li><a href="about.html">About</a></li>
        </ul>
    </nav>

    <!-- Results Container -->
    <section class="results-container">
        <h1>Your Fitness Predictions</h1>
        <p class="subtitle">Based on your input, here are your personalized recommendations</p>
        <div class="user-badges" id="userBadges"></div>

        <!-- Diet Type Main Card -->
        <div class="result-card main-result">
            <div class="result-header">
                <h2>Recommended Diet Type</h2>
                <p class="result-description">Your personalized diet plan based on AI analysis</p>
            </div>
            <div class="diet-type-display" id="dietTypeDisplay">
                <span class="diet-type-value" id="dietTypeValue">Balanced</span>
            </div>
            <div class="diet-type-info" id="dietTypeInfo"></div>
        </div>

        <!-- Features & Meals Section -->
        <div class="features-meals-grid" id="additionalResults"></div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="inputs.html" class="btn-secondary">Try Again</a>
            <a href="homePage.html" class="btn-primary">Back to Home</a>
        </div>
    </section>

    <script>
        // ===== Static Diet Info =====
        const dietInfo = {
            "Balanced": {
                title: "Balanced Diet",
                description: "A diet with proper balance of carbs, protein, and fats for overall health.",
                suitable_for: "Everyone aiming for general wellness and maintenance.",
                features: [
                    "Includes carbs, proteins, and fats in healthy ratios",
                    "Supports overall wellness",
                    "Easy to follow and sustainable"
                ],
                sample_meals: [
                    "Oatmeal with fruits for breakfast",
                    "Grilled chicken salad for lunch",
                    "Salmon with quinoa for dinner"
                ]
            },
            "High-Protein": {
                title: "High-Protein Diet",
                description: "Designed to maximize protein intake for muscle growth and recovery.",
                suitable_for: "People aiming for muscle gain or lean body mass maintenance.",
                features: [
                    "High protein content to support muscle growth",
                    "Moderate carbs and fats",
                    "Ideal for workout enthusiasts"
                ],
                sample_meals: [
                    "Egg whites and turkey bacon for breakfast",
                    "Grilled chicken with brown rice for lunch",
                    "Protein shake and nuts for snacks"
                ]
            },
            "Low-Carb": {
                title: "Low-Carb Diet",
                description: "Minimizes carbs to boost fat loss and metabolic efficiency.",
                suitable_for: "People aiming to lose weight or reduce body fat.",
                features: [
                    "Reduces carbohydrate intake",
                    "Focuses on protein and healthy fats",
                    "Helps in fat burning and weight management"
                ],
                sample_meals: [
                    "Scrambled eggs with avocado for breakfast",
                    "Grilled fish with vegetables for lunch",
                    "Chicken salad with olive oil for dinner"
                ]
            }
        };

        // ===== Update Diet Info Display =====
        function updateDietInfo(dietType) {
            const info = dietInfo[dietType] || dietInfo["Balanced"];
            document.getElementById('dietTypeValue').textContent = info.title;
            document.getElementById('dietTypeInfo').innerHTML = `
                <p>${info.description}</p>
                <p><strong>Suitable for:</strong> ${info.suitable_for}</p>
            `;

            // Update class for styling
            const display = document.getElementById('dietTypeDisplay');
            display.className = 'diet-type-display ' + dietType.toLowerCase().replace('-', '-');

            // Populate features & meals in grid
            const grid = document.getElementById('additionalResults');
            grid.innerHTML = '';

            const featuresCard = document.createElement('div');
            featuresCard.className = 'feature-card';
            featuresCard.innerHTML = `<h3>Key Features</h3><ul>${info.features.map(f => `<li>${f}</li>`).join('')}</ul>`;

            const mealsCard = document.createElement('div');
            mealsCard.className = 'feature-card';
            mealsCard.innerHTML = `<h3>Sample Meals</h3><ul>${info.sample_meals.map(m => `<li>${m}</li>`).join('')}</ul>`;

            grid.appendChild(featuresCard);
            grid.appendChild(mealsCard);
            staggerReveal('.feature-card', 80);
        }

        // ===== User Badges =====
        function renderUserBadges(data) {
            const el = document.getElementById('userBadges');
            if (!el || !data) return;
            const items = [
                { label: 'Age', value: data.age ? `${data.age}` : null },
                { label: 'Gender', value: data.gender || null },
                { label: 'Weight', value: data.weight ? `${data.weight} kg` : null },
                { label: 'Height', value: data.height ? `${data.height} m` : null },
                { label: 'Workout', value: (data.workoutFrequency !== undefined) ? `${data.workoutFrequency} days/wk` : null },
                { label: 'Goal', value: data.goalLabel || null }
            ].filter(x => x.value);
            el.innerHTML = items.map(x => `<span class="badge"><strong>${x.label}:</strong> ${x.value}</span>`).join('');
            staggerReveal('.badge', 60);
        }

        // ===== Fallback Logic =====
        function staggerReveal(selector, step) {
            const nodes = document.querySelectorAll(selector);
            nodes.forEach((n, i) => {
                setTimeout(() => n.classList.add('in-view'), i * step);
            });
        }
        function predictDietTypeFallback(formData) {
            const goal = formData.goalLabel;
            const workoutFreq = Number(formData.workoutFrequency || 0);
            const bmi = Number(formData.bmi || 0);
            if (goal === 'Muscle Gain' || workoutFreq >= 4) return 'High-Protein';
            if (goal === 'Weight Loss' || (bmi > 25 && bmi < 30)) return 'Low-Carb';
            return 'Balanced';
        }

        // ===== Load Prediction =====
        const API_URL = 'http://localhost:5000/api/predict-diet-ml';
        async function loadDietPrediction() {
            try {
                const stored = sessionStorage.getItem('fitnessFormData');
                const urlParams = new URLSearchParams(window.location.search);
                const initialDiet = urlParams.get('dietType');

                if (!stored) {
                    if (initialDiet) {
                        updateDietInfo(initialDiet);
                        return;
                    }
                    alert('No user data found. Please fill out the form first.');
                    window.location.href = 'inputs.html';
                    return;
                }

                const payload = JSON.parse(stored);
                renderUserBadges(payload);
                document.getElementById('dietTypeValue').textContent = 'Loading...';

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const result = await response.json();

                if (result.success && result.dietType) {
                    updateDietInfo(result.dietType);
                } else {
                    const fallback = predictDietTypeFallback(payload);
                    updateDietInfo(initialDiet || fallback);
                }
            } catch (error) {
                const stored = sessionStorage.getItem('fitnessFormData');
                const payload = stored ? JSON.parse(stored) : null;
                const urlParams = new URLSearchParams(window.location.search);
                const initialDiet = urlParams.get('dietType');
                const fallback = payload ? predictDietTypeFallback(payload) : (initialDiet || 'Balanced');
                if (payload) renderUserBadges(payload);
                updateDietInfo(fallback);
            }
        }

        window.addEventListener('DOMContentLoaded', loadDietPrediction);
    </script>

</body>
</html>